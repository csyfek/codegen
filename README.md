# codegen
Multi-purpose code generator for JSON, YAML, SQL, and Go.

This tool is a blind rewrite of prior tools that I've written and used that were much less modular or clearly written.

This is currently a work in progress. At the time of writing, There are two commands that are in a good-enough state, cg-pg and cg-mysql. These two commands have one flag, -file, which accepts a single Go source file. They dump to stdout the resulting DB table definitions and Go bindings.

Regarding the output, the code assumes that you have a db() method somewhere in your code that returns a database pointer and an error. At a minimum, it can look something like this:

    func db() (*sql.DB, error) {

        database := "foo"
        host := "bar"
        port := 1234
        password := "username"
        username := "password"

        connString := fmt.Sprintf("postgres://%s:%s@%s:%s/%s?sslmode=disable", username, password, host, port, database)
        db, err := sql.Open("postgres", connString)
        if err != nil {
            return nil, errors.Stack(err)
        }

        return db, nil
    }

In addition to expecting this sort of function available, We also use the following package for error reporting: github.com/jackmanlabs/errors. This package has the Stack() method to assemble a call stack in addition to the error to facilitate debugging. If you don't like it, it should easy enough to replace it with your own error package or error messages.

Those who have worked with me have probably seen code generated by this tool or one of its ancestors. Its ancestors were typically a small web-app with a basic HTML (no JavaScript) interface for various kinds of transformations. My intent with this tool is to make it much more capable by inspecting entire source files and packages during the data gathering stage.
